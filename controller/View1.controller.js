sap.ui.define(["sap/m/MessageToast","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/Sorter","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/m/MessageBox","sap/ui/core/util/MockServer","sap/ui/export/Spreadsheet","sap/ui/model/odata/v2/ODataModel","sap/ui/model/json/JSONModel","sap/ui/export/Spreadsheet","sap/m/MessageToast"],function(e,r,a,t,i,n,s,l,u,o,d,c,p,h,v){"use strict";var P;var f;var y=0;return r.extend("YY1_PO_DATE_214.YY1_PO_DATE_214.controller.View1",{onClear:function(e){var r="";this.getView().byId("idPurOrg").setValue(r);this.getView().byId("idPlant").setValue(r);this.getView().byId("idSuppl").setValue(r)},onReset:function(e){var r="";this.getView().byId("idPurOrg").setValue(r);this.getView().byId("idPlant").setValue(r);this.getView().byId("idSuppl").setValue(r)},onSearch:function(){var r=this.getView().byId("infocond");var a={infopage:[]};var t=this.getView().byId("idPurOrg").getValue();var i="'"+t+"'";var n=this.getView().byId("idPlant").getValue();var s="'"+n+"'";var l=this.getView().byId("idSuppl").getValue();var u="'"+l+"'";if(t===""||n===""||l===""){if(t===""){var o="Please enter value for Puchasing Org. ";e.show(o)}if(n===""){var o="Please enter value for Plant ";e.show(o)}if(l===""){var o="Please enter value for Supplier ";e.show(o)}}else{var d="Fetching Records.......";e.show(d)}if(t!==""&&n!==""&&l!==""){var c=new sap.ui.model.json.JSONModel;c.setData(a);r.setModel(c,"inforeport");var h="/S4HC/sap/opu/odata/sap/YY1_PURCHASE_DATE_CPI_214_CDS";var v=new sap.ui.model.odata.ODataModel(h,true);var P="/YY1_purchase_date_cpi_214"+"?$filter=(PurchasingOrganization eq "+i+" and Plant eq "+s+" and Supplier eq "+u+")";v.read(P,{success:function(e,r){var t=e.results;var i=t.length;for(var n=0;n<i;n++){if(t[n].ScheduleLineDeliveryDate!==null){var s=JSON.stringify(t[n].ScheduleLineDeliveryDate);s=s.slice(6,8)+"/"+s.slice(9,11)+"/"+s.slice(1,5);var l=s}a.infopage.push({Supplier:t[n].Supplier,PurchaseOrder:t[n].PurchaseOrder,Plant:t[n].Plant,PurchaseOrderItem:t[n].PurchaseOrderItem,Material:t[n].Material,ProductDescription:t[n].PurchaseOrderItemText,ScheduleLineDeliveryDate:l,OrderQuantity:t[n].OrderQuantity_01,PurchaseOrderQuantityUnit:t[n].PurchaseOrderQuantityUnit,PendingQuantity:t[n].PendingQuantity,RoughGoodsReceiptQty:t[n].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:t[n].PurchaseOrderScheduleLine})}f=a.infopage;c.setData(a);$.sap.xampp=a;this.getView().setModel(c,"inforeport");var u=new p;u.setData(a);u.setSizeLimit(1e6);this.getView().setModel(u,"inforeport")}})}},onStat:function(){var r=this.getView().byId("infocond");var a=f;var t={infopage:[]};var i=a.length;if(i===0){var n="No data available for the input provided ";e.show(n)}if(i>0){var s=new sap.ui.model.json.JSONModel;var l="/S4HC/sap/opu/odata/sap/API_PURCHASEORDER_PROCESS_SRV/";var u=new sap.ui.model.odata.ODataModel(l,true);s.setData(t);r.setModel(s,"inforeport");var o=0;var d=new Array;var c=new Array;for(var h=0;h<i;h++){d[o]=a[h].PurchaseOrder;c[o]=a[h].PurchaseOrderItem;o=o+1;if(o===40){var v=d.filter(function(e,r,a){return a.indexOf(e)===r});var P=[];for(var y=0;y<v.length;y++){P.push(new sap.ui.model.Filter("PurchasingDocument",sap.ui.model.FilterOperator.EQ,v[y]))}var g=new sap.ui.model.Filter({filters:P,and:false});var O=new Array(new sap.ui.model.Filter({filters:[g],and:true}));var S="A_PurchaseOrderScheduleLine";u.read(S,{async:false,filters:[O],success:function(e,r){var a=e.results;var i=a;var n=i.length;var s=f.length;for(var l=0;l<s;l++){for(var u=0;u<n;u++){var o="000"+a[u].PurchasingDocumentItem;var d="000"+a[u].ScheduleLine;if(f[l].PurchaseOrder===a[u].PurchasingDocument&&f[l].PurchaseOrderItem===o&&f[l].PurchaseOrderScheduleLine===d){if(a[u].SchedLineStscDeliveryDate!==null){var c=JSON.stringify(a[u].SchedLineStscDeliveryDate);c=c.slice(6,8)+"/"+c.slice(9,11)+"/"+c.slice(1,5);var p=[];p=c}t.infopage.push({Supplier:f[l].Supplier,PurchaseOrder:f[l].PurchaseOrder,Plant:f[l].Plant,PurchaseOrderItem:f[l].PurchaseOrderItem,Material:f[l].Material,ProductDescription:f[l].ProductDescription,ScheduleLineDeliveryDate:f[l].ScheduleLineDeliveryDate,StatisticalDeliveryDate:p,OrderQuantity:f[l].OrderQuantity,PurchaseOrderQuantityUnit:f[l].PurchaseOrderQuantityUnit,PendingQuantity:f[l].PendingQuantity,RoughGoodsReceiptQty:f[l].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:f[l].PurchaseOrderScheduleLine})}}}}});o=0;d=[];c=[]}}var D=d.filter(function(e,r,a){return a.indexOf(e)===r});var m=[];for(var y=0;y<D.length;y++){m.push(new sap.ui.model.Filter("PurchasingDocument",sap.ui.model.FilterOperator.EQ,D[y]))}var w=new sap.ui.model.Filter({filters:m,and:false});var Q=new Array(new sap.ui.model.Filter({filters:[w],and:true}));var S="A_PurchaseOrderScheduleLine";u.read(S,{async:false,filters:[Q],success:function(e,r){var a=e.results;var i=a;var n=i.length;var s=f.length;for(var l=0;l<s;l++){for(var u=0;u<n;u++){var o="000"+a[u].PurchasingDocumentItem;var d="000"+a[u].ScheduleLine;if(f[l].PurchaseOrder===a[u].PurchasingDocument&&f[l].PurchaseOrderItem===o&&f[l].PurchaseOrderScheduleLine===d){if(a[u].SchedLineStscDeliveryDate!==null){var c=JSON.stringify(a[u].SchedLineStscDeliveryDate);c=c.slice(6,8)+"/"+c.slice(9,11)+"/"+c.slice(1,5);var p=[];p=c}t.infopage.push({Supplier:f[l].Supplier,Plant:f[l].Plant,PurchaseOrder:f[l].PurchaseOrder,PurchaseOrderItem:f[l].PurchaseOrderItem,Material:f[l].Material,ProductDescription:f[l].ProductDescription,ScheduleLineDeliveryDate:f[l].ScheduleLineDeliveryDate,StatisticalDeliveryDate:p,OrderQuantity:f[l].OrderQuantity,PurchaseOrderQuantityUnit:f[l].PurchaseOrderQuantityUnit,PendingQuantity:f[l].PendingQuantity,RoughGoodsReceiptQty:f[l].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:f[l].PurchaseOrderScheduleLine})}}}}});s.setData(t);$.sap.xampp=t;this.getView().setModel(s,"inforeport");var L=new p;L.setData(t);L.setSizeLimit(1e6);this.getView().setModel(L,"inforeport")}},onExcel:sap.m.Table.prototype.exportData||function(e){e.saveFile().catch(function(e){}).then(function(){e.destroy()})},onBeforeExport:function(e){var r=e.getParameter("exportSettings");r.worker=false},onExportExcel:function(){var e,r,a,t;e=this.createColumnConfig();r=$.sap.xampp.infopage;var i=new Date;a={workbook:{columns:e},dataSource:r,showProgress:false,fileName:"PO Schedule Line Details_"+i.getUTCDate()+"-"+(i.getUTCMonth()+1)+"-"+i.getUTCFullYear()};t=new h(a);t.build().then(function(){v.show("Excel export has finished")}).finally(function(){t.destroy()})},createColumnConfig:function(){return[{label:"Fornitore",property:"Supplier"},{label:"Plant",property:"Plant"},{label:"OrdineDAcquisto",property:"PurchaseOrder"},{label:"Pos",property:"PurchaseOrderItem"},{label:"Codice",property:"Material"},{label:"Descrizione della parte",property:"ProductDescription"},{label:"DataDiConsegna",property:"ScheduleLineDeliveryDate"},{label:"Data di consegna statistica",property:"StatisticalDeliveryDate"},{label:"QuantitÃ Ordine",property:"OrderQuantity"},{label:"Udm",property:"PurchaseOrderQuantityUnit"},{label:"Quantita in sospeso",property:"PendingQuantity"},{label:"Quantita GR",property:"RoughGoodsReceiptQty"},{label:"Purchase Order Schedule Line",property:"PurchaseOrderScheduleLine"}]}})});