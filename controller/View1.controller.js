sap.ui.define(["sap/m/MessageToast","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/Sorter","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/m/MessageBox","sap/ui/core/util/MockServer","sap/ui/export/Spreadsheet","sap/ui/model/odata/v2/ODataModel","sap/ui/model/json/JSONModel"],function(e,r,a,t,i,s,n,u,o,l,c,d,p){"use strict";var h;var v;var f=0;return r.extend("YY1_PO_DATE_214.YY1_PO_DATE_214.controller.View1",{onClear:function(e){var r="";this.getView().byId("idPurOrg").setValue(r)},onSearch:function(){debugger;var r=this.getView().byId("infocond");var a={infopage:[]};var t=this.getView().byId("idPurOrg").getValue();var i="'"+t+"'";if(t===" "){var s="Please enter value for Purchasing Organisation";e.show(s)}else{s="Fetching Records.......";e.show(s)}var n=new sap.ui.model.json.JSONModel;n.setData(a);r.setModel(n,"inforeport");var u="/S4HC/sap/opu/odata/sap/YY1_PURCHASE_DATE_CPI_214_CDS";var o=new sap.ui.model.odata.ODataModel(u,true);var l="/YY1_purchase_date_cpi_214"+"?$filter=(PurchasingOrganization eq "+i+")";debugger;o.read(l,{success:function(e,r){var t=e.results;var i=t.length;debugger;for(var s=0;s<i;s++){if(t[s].ScheduleLineDeliveryDate!==null){var u=JSON.stringify(t[s].ScheduleLineDeliveryDate);u=u.slice(6,8)+"/"+u.slice(9,11)+"/"+u.slice(1,5);var o=u}a.infopage.push({Supplier:t[s].Supplier,PurchaseOrder:t[s].PurchaseOrder,PurchaseOrderItem:t[s].PurchaseOrderItem,Material:t[s].Material,ProductDescription:t[s].PurchaseOrderItemText,ScheduleLineDeliveryDate:o,OrderQuantity:t[s].OrderQuantity_01,PurchaseOrderQuantityUnit:t[s].PurchaseOrderQuantityUnit,PendingQuantity:t[s].PendingQuantity,RoughGoodsReceiptQty:t[s].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:t[s].PurchaseOrderScheduleLine})}v=a.infopage;n.setData(a);this.getView().setModel(n,"inforeport");var l=new p;l.setData(a);l.setSizeLimit(1e6);this.getView().setModel(l,"inforeport")}})},onStat:function(){var e=this.getView().byId("infocond");var r=v;var a={infopage:[]};debugger;var t=r.length;var i=new sap.ui.model.json.JSONModel;var s="/S4HC/sap/opu/odata/sap/API_PURCHASEORDER_PROCESS_SRV/";var n=new sap.ui.model.odata.ODataModel(s,true);i.setData(a);e.setModel(i,"inforeport");var u=0;var o=new Array;var l=new Array;for(var c=0;c<t;c++){o[u]=r[c].PurchaseOrder;l[u]=r[c].PurchaseOrderItem;u=u+1;if(u===40){var d=o.filter(function(e,r,a){return a.indexOf(e)===r});var h=[];for(var f=0;f<d.length;f++){h.push(new sap.ui.model.Filter("PurchasingDocument",sap.ui.model.FilterOperator.EQ,d[f]))}var P=new sap.ui.model.Filter({filters:h,and:false});var g=new Array(new sap.ui.model.Filter({filters:[P],and:true}));var y="A_PurchaseOrderScheduleLine";n.read(y,{async:false,filters:[g],success:function(e,r){var t=e.results;var i=t;var s=i.length;var n=v.length;for(var u=0;u<n;u++){for(var o=0;o<s;o++){var l="000"+t[o].PurchasingDocumentItem;var c="000"+t[o].ScheduleLine;if(v[u].PurchaseOrder===t[o].PurchasingDocument&&v[u].PurchaseOrderItem===l&&v[u].PurchaseOrderScheduleLine===c){if(t[o].SchedLineStscDeliveryDate!==null){var d=JSON.stringify(t[o].SchedLineStscDeliveryDate);d=d.slice(6,8)+"/"+d.slice(9,11)+"/"+d.slice(1,5);var p=[];p=d}a.infopage.push({Supplier:v[u].Supplier,PurchaseOrder:v[u].PurchaseOrder,PurchaseOrderItem:v[u].PurchaseOrderItem,Material:v[u].Material,ProductDescription:v[u].ProductDescription,ScheduleLineDeliveryDate:v[u].ScheduleLineDeliveryDate,StatisticalDeliveryDate:p,OrderQuantity:v[u].OrderQuantity,PurchaseOrderQuantityUnit:v[u].PurchaseOrderQuantityUnit,PendingQuantity:v[u].PendingQuantity,RoughGoodsReceiptQty:v[u].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:v[u].PurchaseOrderScheduleLine})}}}}});u=0;o=[];l=[]}}var O=o.filter(function(e,r,a){return a.indexOf(e)===r});var S=[];for(var f=0;f<O.length;f++){S.push(new sap.ui.model.Filter("PurchasingDocument",sap.ui.model.FilterOperator.EQ,O[f]))}var D=new sap.ui.model.Filter({filters:S,and:false});var m=new Array(new sap.ui.model.Filter({filters:[D],and:true}));n.read(y,{async:false,filters:[m],success:function(e,r){var t=e.results;var i=t;var s=i.length;var n=v.length;for(var u=0;u<n;u++){for(var o=0;o<s;o++){var l="000"+t[o].PurchasingDocumentItem;var c="000"+t[o].ScheduleLine;if(v[u].PurchaseOrder===t[o].PurchasingDocument&&v[u].PurchaseOrderItem===l&&v[u].PurchaseOrderScheduleLine===c){if(t[o].SchedLineStscDeliveryDate!==null){var d=JSON.stringify(t[o].SchedLineStscDeliveryDate);d=d.slice(6,8)+"/"+d.slice(9,11)+"/"+d.slice(1,5);var p=[];p=d}a.infopage.push({Supplier:v[u].Supplier,PurchaseOrder:v[u].PurchaseOrder,PurchaseOrderItem:v[u].PurchaseOrderItem,Material:v[u].Material,ProductDescription:v[u].ProductDescription,ScheduleLineDeliveryDate:v[u].ScheduleLineDeliveryDate,StatisticalDeliveryDate:p,OrderQuantity:v[u].OrderQuantity,PurchaseOrderQuantityUnit:v[u].PurchaseOrderQuantityUnit,PendingQuantity:v[u].PendingQuantity,RoughGoodsReceiptQty:v[u].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:v[u].PurchaseOrderScheduleLine})}}}}});i.setData(a);this.getView().setModel(i,"inforeport");var w=new p;w.setData(a);w.setSizeLimit(1e6);this.getView().setModel(w,"inforeport")},onExportExcel:function(e){jQuery.sap.require("sap.ui.core.util.Export");jQuery.sap.require("sap.ui.core.util.ExportTypeCSV");var e=this.byId("infocond");e.exportData({exportType:new sap.ui.core.util.ExportTypeCSV}).saveFile().always(function(){this.destroy()})},onExcel:sap.m.Table.prototype.exportData||function(e){e.saveFile().catch(function(e){}).then(function(){e.destroy()})},onBeforeExport:function(e){var r=e.getParameter("exportSettings");r.worker=false}})});