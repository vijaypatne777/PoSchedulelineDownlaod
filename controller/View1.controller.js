sap.ui.define(["sap/m/MessageToast","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/Sorter","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/m/MessageBox","sap/ui/core/util/MockServer","sap/ui/export/Spreadsheet","sap/ui/model/odata/v2/ODataModel","sap/ui/model/json/JSONModel"],function(e,r,a,t,i,n,s,u,o,l,d,c,p){"use strict";var h;var v;var f=0;return r.extend("YY1_PO_DATE_214.YY1_PO_DATE_214.controller.View1",{onClear:function(e){var r="";this.getView().byId("idPurOrg").setValue(r)},onSearch:function(){var r=this.getView().byId("infocond");var a={infopage:[]};var t=this.getView().byId("idPurOrg").getValue();var i="'"+t+"'";var n=this.getView().byId("idPlant").getValue();var s="'"+n+"'";var u=this.getView().byId("idSuppl").getValue();var o="'"+u+"'";if(t===""||n===""||u===""){if(t===""){var l="Please enter value for Puchasing Org. ";e.show(l)}if(n===""){var l="Please enter value for Plant ";e.show(l)}if(u===""){var l="Please enter value for Supplier ";e.show(l)}}else{var d="Fetching Records.......";e.show(d)}if(t!==""&&n!==""&&u!==""){var c=new sap.ui.model.json.JSONModel;c.setData(a);r.setModel(c,"inforeport");var h="/S4HC/sap/opu/odata/sap/YY1_PURCHASE_DATE_CPI_214_CDS";var f=new sap.ui.model.odata.ODataModel(h,true);var P="/YY1_purchase_date_cpi_214"+"?$filter=(PurchasingOrganization eq "+i+" and Plant eq "+s+" and Supplier eq "+o+")";f.read(P,{success:function(e,r){var t=e.results;var i=t.length;for(var n=0;n<i;n++){if(t[n].ScheduleLineDeliveryDate!==null){var s=JSON.stringify(t[n].ScheduleLineDeliveryDate);s=s.slice(6,8)+"/"+s.slice(9,11)+"/"+s.slice(1,5);var u=s}a.infopage.push({Supplier:t[n].Supplier,PurchaseOrder:t[n].PurchaseOrder,Plant:t[n].Plant,PurchaseOrderItem:t[n].PurchaseOrderItem,Material:t[n].Material,ProductDescription:t[n].PurchaseOrderItemText,ScheduleLineDeliveryDate:u,OrderQuantity:t[n].OrderQuantity_01,PurchaseOrderQuantityUnit:t[n].PurchaseOrderQuantityUnit,PendingQuantity:t[n].PendingQuantity,RoughGoodsReceiptQty:t[n].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:t[n].PurchaseOrderScheduleLine})}v=a.infopage;c.setData(a);this.getView().setModel(c,"inforeport");var o=new p;o.setData(a);o.setSizeLimit(1e6);this.getView().setModel(o,"inforeport")}})}},onStat:function(){var r=this.getView().byId("infocond");var a=v;var t={infopage:[]};var i=a.length;if(i===0){var n="No data available for the input provided ";e.show(n)}if(i>0){var s=new sap.ui.model.json.JSONModel;var u="/S4HC/sap/opu/odata/sap/API_PURCHASEORDER_PROCESS_SRV/";var o=new sap.ui.model.odata.ODataModel(u,true);s.setData(t);r.setModel(s,"inforeport");var l=0;var d=new Array;var c=new Array;for(var h=0;h<i;h++){d[l]=a[h].PurchaseOrder;c[l]=a[h].PurchaseOrderItem;l=l+1;if(l===40){var f=d.filter(function(e,r,a){return a.indexOf(e)===r});var P=[];for(var y=0;y<f.length;y++){P.push(new sap.ui.model.Filter("PurchasingDocument",sap.ui.model.FilterOperator.EQ,f[y]))}var O=new sap.ui.model.Filter({filters:P,and:false});var S=new Array(new sap.ui.model.Filter({filters:[O],and:true}));var g="A_PurchaseOrderScheduleLine";o.read(g,{async:false,filters:[S],success:function(e,r){var a=e.results;var i=a;var n=i.length;var s=v.length;for(var u=0;u<s;u++){for(var o=0;o<n;o++){var l="000"+a[o].PurchasingDocumentItem;var d="000"+a[o].ScheduleLine;if(v[u].PurchaseOrder===a[o].PurchasingDocument&&v[u].PurchaseOrderItem===l&&v[u].PurchaseOrderScheduleLine===d){if(a[o].SchedLineStscDeliveryDate!==null){var c=JSON.stringify(a[o].SchedLineStscDeliveryDate);c=c.slice(6,8)+"/"+c.slice(9,11)+"/"+c.slice(1,5);var p=[];p=c}t.infopage.push({Supplier:v[u].Supplier,PurchaseOrder:v[u].PurchaseOrder,Plant:v[u].Plant,PurchaseOrderItem:v[u].PurchaseOrderItem,Material:v[u].Material,ProductDescription:v[u].ProductDescription,ScheduleLineDeliveryDate:v[u].ScheduleLineDeliveryDate,StatisticalDeliveryDate:p,OrderQuantity:v[u].OrderQuantity,PurchaseOrderQuantityUnit:v[u].PurchaseOrderQuantityUnit,PendingQuantity:v[u].PendingQuantity,RoughGoodsReceiptQty:v[u].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:v[u].PurchaseOrderScheduleLine})}}}}});l=0;d=[];c=[]}}var D=d.filter(function(e,r,a){return a.indexOf(e)===r});var m=[];for(var y=0;y<D.length;y++){m.push(new sap.ui.model.Filter("PurchasingDocument",sap.ui.model.FilterOperator.EQ,D[y]))}var w=new sap.ui.model.Filter({filters:m,and:false});var Q=new Array(new sap.ui.model.Filter({filters:[w],and:true}));var g="A_PurchaseOrderScheduleLine";o.read(g,{async:false,filters:[Q],success:function(e,r){var a=e.results;var i=a;var n=i.length;var s=v.length;for(var u=0;u<s;u++){for(var o=0;o<n;o++){var l="000"+a[o].PurchasingDocumentItem;var d="000"+a[o].ScheduleLine;if(v[u].PurchaseOrder===a[o].PurchasingDocument&&v[u].PurchaseOrderItem===l&&v[u].PurchaseOrderScheduleLine===d){if(a[o].SchedLineStscDeliveryDate!==null){var c=JSON.stringify(a[o].SchedLineStscDeliveryDate);c=c.slice(6,8)+"/"+c.slice(9,11)+"/"+c.slice(1,5);var p=[];p=c}t.infopage.push({Supplier:v[u].Supplier,Plant:v[u].Plant,PurchaseOrder:v[u].PurchaseOrder,PurchaseOrderItem:v[u].PurchaseOrderItem,Material:v[u].Material,ProductDescription:v[u].ProductDescription,ScheduleLineDeliveryDate:v[u].ScheduleLineDeliveryDate,StatisticalDeliveryDate:p,OrderQuantity:v[u].OrderQuantity,PurchaseOrderQuantityUnit:v[u].PurchaseOrderQuantityUnit,PendingQuantity:v[u].PendingQuantity,RoughGoodsReceiptQty:v[u].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:v[u].PurchaseOrderScheduleLine})}}}}});s.setData(t);this.getView().setModel(s,"inforeport");var L=new p;L.setData(t);L.setSizeLimit(1e6);this.getView().setModel(L,"inforeport")}},onExportExcel:function(e){jQuery.sap.require("sap.ui.core.util.Export");jQuery.sap.require("sap.ui.core.util.ExportTypeCSV");var e=this.byId("infocond");e.exportData({exportType:new sap.ui.core.util.ExportTypeCSV}).saveFile().always(function(){this.destroy()})},onExcel:sap.m.Table.prototype.exportData||function(e){e.saveFile().catch(function(e){}).then(function(){e.destroy()})},onBeforeExport:function(e){var r=e.getParameter("exportSettings");r.worker=false}})});