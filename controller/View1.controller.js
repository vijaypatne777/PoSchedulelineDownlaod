sap.ui.define(["sap/m/MessageToast","sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/model/FilterType","sap/ui/model/Sorter","sap/ui/core/util/Export","sap/ui/core/util/ExportTypeCSV","sap/m/MessageBox","sap/ui/core/util/MockServer","sap/ui/export/Spreadsheet","sap/ui/model/odata/v2/ODataModel","sap/ui/model/json/JSONModel"],function(e,r,a,t,i,s,n,u,l,o,d,c,p){"use strict";var h;var v;var P=0;return r.extend("YY1_PO_DATE_214.YY1_PO_DATE_214.controller.View1",{onClear:function(e){var r="";this.getView().byId("idPurOrg").setValue(r);this.getView().byId("idPlant").setValue(r);this.getView().byId("idSuppl").setValue(r)},onReset:function(e){var r="";this.getView().byId("idPurOrg").setValue(r);this.getView().byId("idPlant").setValue(r);this.getView().byId("idSuppl").setValue(r)},onSearch:function(){var r=this.getView().byId("infocond");var a={infopage:[]};var t=this.getView().byId("idPurOrg").getValue();var i="'"+t+"'";var s=this.getView().byId("idPlant").getValue();var n="'"+s+"'";var u=this.getView().byId("idSuppl").getValue();var l="'"+u+"'";if(t===""||s===""||u===""){if(t===""){var o="Please enter value for Puchasing Org. ";e.show(o)}if(s===""){var o="Please enter value for Plant ";e.show(o)}if(u===""){var o="Please enter value for Supplier ";e.show(o)}}else{var d="Fetching Records.......";e.show(d)}if(t!==""&&s!==""&&u!==""){var c=new sap.ui.model.json.JSONModel;c.setData(a);r.setModel(c,"inforeport");var h="/S4HC/sap/opu/odata/sap/YY1_PURCHASE_DATE_CPI_214_CDS";var P=new sap.ui.model.odata.ODataModel(h,true);var f="/YY1_purchase_date_cpi_214"+"?$filter=(PurchasingOrganization eq "+i+" and Plant eq "+n+" and Supplier eq "+l+")";P.read(f,{success:function(e,r){var t=e.results;var i=t.length;for(var s=0;s<i;s++){if(t[s].ScheduleLineDeliveryDate!==null){var n=JSON.stringify(t[s].ScheduleLineDeliveryDate);n=n.slice(6,8)+"/"+n.slice(9,11)+"/"+n.slice(1,5);var u=n}a.infopage.push({Supplier:t[s].Supplier,PurchaseOrder:t[s].PurchaseOrder,Plant:t[s].Plant,PurchaseOrderItem:t[s].PurchaseOrderItem,Material:t[s].Material,ProductDescription:t[s].PurchaseOrderItemText,ScheduleLineDeliveryDate:u,OrderQuantity:t[s].OrderQuantity_01,PurchaseOrderQuantityUnit:t[s].PurchaseOrderQuantityUnit,PendingQuantity:t[s].PendingQuantity,RoughGoodsReceiptQty:t[s].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:t[s].PurchaseOrderScheduleLine})}v=a.infopage;c.setData(a);this.getView().setModel(c,"inforeport");var l=new p;l.setData(a);l.setSizeLimit(1e6);this.getView().setModel(l,"inforeport")}})}},onStat:function(){var r=this.getView().byId("infocond");var a=v;var t={infopage:[]};var i=a.length;if(i===0){var s="No data available for the input provided ";e.show(s)}if(i>0){var n=new sap.ui.model.json.JSONModel;var u="/S4HC/sap/opu/odata/sap/API_PURCHASEORDER_PROCESS_SRV/";var l=new sap.ui.model.odata.ODataModel(u,true);n.setData(t);r.setModel(n,"inforeport");var o=0;var d=new Array;var c=new Array;for(var h=0;h<i;h++){d[o]=a[h].PurchaseOrder;c[o]=a[h].PurchaseOrderItem;o=o+1;if(o===40){var P=d.filter(function(e,r,a){return a.indexOf(e)===r});var f=[];for(var y=0;y<P.length;y++){f.push(new sap.ui.model.Filter("PurchasingDocument",sap.ui.model.FilterOperator.EQ,P[y]))}var g=new sap.ui.model.Filter({filters:f,and:false});var S=new Array(new sap.ui.model.Filter({filters:[g],and:true}));var O="A_PurchaseOrderScheduleLine";l.read(O,{async:false,filters:[S],success:function(e,r){var a=e.results;var i=a;var s=i.length;var n=v.length;for(var u=0;u<n;u++){for(var l=0;l<s;l++){var o="000"+a[l].PurchasingDocumentItem;var d="000"+a[l].ScheduleLine;if(v[u].PurchaseOrder===a[l].PurchasingDocument&&v[u].PurchaseOrderItem===o&&v[u].PurchaseOrderScheduleLine===d){if(a[l].SchedLineStscDeliveryDate!==null){var c=JSON.stringify(a[l].SchedLineStscDeliveryDate);c=c.slice(6,8)+"/"+c.slice(9,11)+"/"+c.slice(1,5);var p=[];p=c}t.infopage.push({Supplier:v[u].Supplier,PurchaseOrder:v[u].PurchaseOrder,Plant:v[u].Plant,PurchaseOrderItem:v[u].PurchaseOrderItem,Material:v[u].Material,ProductDescription:v[u].ProductDescription,ScheduleLineDeliveryDate:v[u].ScheduleLineDeliveryDate,StatisticalDeliveryDate:p,OrderQuantity:v[u].OrderQuantity,PurchaseOrderQuantityUnit:v[u].PurchaseOrderQuantityUnit,PendingQuantity:v[u].PendingQuantity,RoughGoodsReceiptQty:v[u].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:v[u].PurchaseOrderScheduleLine})}}}}});o=0;d=[];c=[]}}var D=d.filter(function(e,r,a){return a.indexOf(e)===r});var m=[];for(var y=0;y<D.length;y++){m.push(new sap.ui.model.Filter("PurchasingDocument",sap.ui.model.FilterOperator.EQ,D[y]))}var w=new sap.ui.model.Filter({filters:m,and:false});var V=new Array(new sap.ui.model.Filter({filters:[w],and:true}));var O="A_PurchaseOrderScheduleLine";l.read(O,{async:false,filters:[V],success:function(e,r){var a=e.results;var i=a;var s=i.length;var n=v.length;for(var u=0;u<n;u++){for(var l=0;l<s;l++){var o="000"+a[l].PurchasingDocumentItem;var d="000"+a[l].ScheduleLine;if(v[u].PurchaseOrder===a[l].PurchasingDocument&&v[u].PurchaseOrderItem===o&&v[u].PurchaseOrderScheduleLine===d){if(a[l].SchedLineStscDeliveryDate!==null){var c=JSON.stringify(a[l].SchedLineStscDeliveryDate);c=c.slice(6,8)+"/"+c.slice(9,11)+"/"+c.slice(1,5);var p=[];p=c}t.infopage.push({Supplier:v[u].Supplier,Plant:v[u].Plant,PurchaseOrder:v[u].PurchaseOrder,PurchaseOrderItem:v[u].PurchaseOrderItem,Material:v[u].Material,ProductDescription:v[u].ProductDescription,ScheduleLineDeliveryDate:v[u].ScheduleLineDeliveryDate,StatisticalDeliveryDate:p,OrderQuantity:v[u].OrderQuantity,PurchaseOrderQuantityUnit:v[u].PurchaseOrderQuantityUnit,PendingQuantity:v[u].PendingQuantity,RoughGoodsReceiptQty:v[u].RoughGoodsReceiptQty,PurchaseOrderScheduleLine:v[u].PurchaseOrderScheduleLine})}}}}});n.setData(t);this.getView().setModel(n,"inforeport");var Q=new p;Q.setData(t);Q.setSizeLimit(1e6);this.getView().setModel(Q,"inforeport")}},onExportExcel:function(e){jQuery.sap.require("sap.ui.core.util.Export");jQuery.sap.require("sap.ui.core.util.ExportTypeCSV");var e=this.byId("infocond");debugger;e.exportData({exportType:new sap.ui.core.util.ExportTypeCSV}).saveFile().always(function(){this.destroy()})},onExcel:sap.m.Table.prototype.exportData||function(e){e.saveFile().catch(function(e){}).then(function(){e.destroy()})},onBeforeExport:function(e){var r=e.getParameter("exportSettings");r.worker=false}})});